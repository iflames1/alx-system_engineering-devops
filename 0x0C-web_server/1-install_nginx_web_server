#!/usr/bin/env bash
# Install nginx, should be listening on port 80

# Update package list and install Nginx
apt-get update
apt-get install -y nginx

# Create the HTML file with "Hello World!" content
echo "Hello World!" > /var/www/html/index.html

# Restart Nginx to apply changes
nginx -s reload

# Ensure Nginx is listening on port 80
if ! grep -q "listen 80;" /etc/nginx/sites-available/default; then
    sed -i 's/listen 80 default_server;/listen 80;/g' /etc/nginx/sites-available/default
    sed -i 's/listen \[::\]:80 default_server;/listen \[::\]:80;/g' /etc/nginx/sites-available/default
fi

# Reload Nginx to apply the port listening change
nginx -s reload

## Check if Nginx is running and listening on port 80
#curl_output=$(curl -s http://localhost)
#if [[ "$curl_output" == *"Hello World!"* ]]; then
#    echo "Nginx is configured correctly."
#else
#    echo "Nginx is not configured correctly."
#fi
